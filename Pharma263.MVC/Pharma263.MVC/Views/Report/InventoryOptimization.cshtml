@{
    ViewData["Title"] = "Inventory Optimization Hub - Strategic Inventory Management";
}

<div class="container-fluid mt-4">
    <!-- Inventory Header -->
    <div class="inventory-header mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="inventory-title">
                    <i class="fas fa-cubes me-3"></i>Inventory Optimization Hub
                </h1>
                <p class="inventory-subtitle">Strategic inventory management and optimization intelligence</p>
            </div>
            <div class="col-md-4">
                <div class="d-flex justify-content-end gap-2 flex-wrap">
                    <button class="btn btn-outline-warning" onclick="generateReorderAlert()">
                        <i class="fas fa-exclamation-triangle me-1"></i>Reorder Alert
                    </button>
                    <button class="btn btn-outline-primary" onclick="exportInventoryReport()">
                        <i class="fas fa-file-chart-column me-1"></i>Optimization Report
                    </button>
                    <a href="@Url.Action("Index", "Report")" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i>Reports Hub
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory KPI Overview -->
    <div class="row mb-4">
        <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
            <div class="inventory-card total">
                <div class="inventory-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="inventory-content">
                    <h3 id="totalItems">2,847</h3>
                    <p class="inventory-label">Total Items</p>
                    <div class="inventory-metric">$285,420 value</div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
            <div class="inventory-card turnover">
                <div class="inventory-icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <div class="inventory-content">
                    <h3 id="avgTurnover">4.2x</h3>
                    <p class="inventory-label">Avg Turnover</p>
                    <div class="inventory-metric">Per year</div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
            <div class="inventory-card reorder">
                <div class="inventory-icon">
                    <i class="fas fa-arrow-circle-down"></i>
                </div>
                <div class="inventory-content">
                    <h3 id="reorderPoints">23</h3>
                    <p class="inventory-label">Reorder Alerts</p>
                    <div class="inventory-metric">Action needed</div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
            <div class="inventory-card slow">
                <div class="inventory-icon">
                    <i class="fas fa-turtle"></i>
                </div>
                <div class="inventory-content">
                    <h3 id="slowMoving">147</h3>
                    <p class="inventory-label">Slow Moving</p>
                    <div class="inventory-metric">< 1x turnover</div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
            <div class="inventory-card excess">
                <div class="inventory-icon">
                    <i class="fas fa-warehouse"></i>
                </div>
                <div class="inventory-content">
                    <h3 id="excessStock">$45,280</h3>
                    <p class="inventory-label">Excess Stock</p>
                    <div class="inventory-metric">Optimize</div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
            <div class="inventory-card efficiency">
                <div class="inventory-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="inventory-content">
                    <h3 id="efficiency">87%</h3>
                    <p class="inventory-label">Efficiency</p>
                    <div class="inventory-metric">Above target</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Analysis Dashboard -->
    <div class="row mb-4">
        <!-- ABC Analysis Visualization -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-sort-amount-down me-2"></i>ABC Classification Analysis
                    </h5>
                    <button class="btn btn-sm btn-outline-primary" onclick="refreshABCAnalysis()">
                        <i class="fas fa-sync me-1"></i>Refresh
                    </button>
                </div>
                <div class="card-body">
                    <div class="abc-summary mb-3">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="abc-item a-class">
                                    <h4>245</h4>
                                    <p class="mb-0">Class A Items</p>
                                    <small class="text-muted">80% of revenue</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="abc-item b-class">
                                    <h4>568</h4>
                                    <p class="mb-0">Class B Items</p>
                                    <small class="text-muted">15% of revenue</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="abc-item c-class">
                                    <h4>2,034</h4>
                                    <p class="mb-0">Class C Items</p>
                                    <small class="text-muted">5% of revenue</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <canvas id="abcChart" height="250"></canvas>
                </div>
            </div>
        </div>

        <!-- Turnover Analysis -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar me-2"></i>Inventory Turnover Distribution
                    </h5>
                    <div class="turnover-period">
                        <select class="form-select form-select-sm" id="turnoverPeriod" onchange="updateTurnoverAnalysis()">
                            <option value="quarterly">Quarterly</option>
                            <option value="yearly" selected>Yearly</option>
                            <option value="ytd">Year to Date</option>
                        </select>
                    </div>
                </div>
                <div class="card-body">
                    <div class="turnover-metrics mb-3">
                        <div class="row">
                            <div class="col-6">
                                <div class="metric-item">
                                    <span class="metric-label">Fast Moving (>6x)</span>
                                    <div class="d-flex justify-content-between">
                                        <strong class="text-success">156 items</strong>
                                        <span class="badge bg-success">5.5%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="metric-item">
                                    <span class="metric-label">Medium (2-6x)</span>
                                    <div class="d-flex justify-content-between">
                                        <strong class="text-info">2,544 items</strong>
                                        <span class="badge bg-info">89.4%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-6">
                                <div class="metric-item">
                                    <span class="metric-label">Slow Moving (<2x)</span>
                                    <div class="d-flex justify-content-between">
                                        <strong class="text-warning">124 items</strong>
                                        <span class="badge bg-warning">4.4%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="metric-item">
                                    <span class="metric-label">Dead Stock (0x)</span>
                                    <div class="d-flex justify-content-between">
                                        <strong class="text-danger">23 items</strong>
                                        <span class="badge bg-danger">0.8%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <canvas id="turnoverChart" height="220"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Optimization Recommendations -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb me-2 text-warning"></i>Optimization Recommendations
                    </h5>
                    <button class="btn btn-sm btn-success" onclick="implementRecommendations()">
                        <i class="fas fa-magic me-1"></i>Auto-Implement
                    </button>
                </div>
                <div class="card-body">
                    <div class="recommendation-list" id="recommendationsList">
                        <!-- Dynamic recommendations -->
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-dollar-sign me-2"></i>Potential Savings
                    </h6>
                </div>
                <div class="card-body">
                    <div class="savings-item mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>Reduce Excess Stock</span>
                            <strong class="text-success">$18,450</strong>
                        </div>
                        <div class="progress mt-1">
                            <div class="progress-bar bg-success" style="width: 65%"></div>
                        </div>
                        <small class="text-muted">High impact</small>
                    </div>
                    <div class="savings-item mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>Optimize Reorder Points</span>
                            <strong class="text-info">$8,220</strong>
                        </div>
                        <div class="progress mt-1">
                            <div class="progress-bar bg-info" style="width: 35%"></div>
                        </div>
                        <small class="text-muted">Medium impact</small>
                    </div>
                    <div class="savings-item mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>Improve Turnover</span>
                            <strong class="text-warning">$5,680</strong>
                        </div>
                        <div class="progress mt-1">
                            <div class="progress-bar bg-warning" style="width: 25%"></div>
                        </div>
                        <small class="text-muted">Long-term impact</small>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <strong>Total Potential:</strong>
                        <strong class="text-primary">$32,350</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Analysis Tables -->
    <div class="row">
        <!-- Critical Items Requiring Action -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2 text-danger"></i>Critical Items
                    </h6>
                    <span class="badge bg-danger" id="criticalItemsCount">15</span>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm table-hover">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Issue</th>
                                    <th>Current Stock</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="criticalItemsTable">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Performers -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">
                        <i class="fas fa-trophy me-2 text-success"></i>Top Performing Items
                    </h6>
                    <button class="btn btn-sm btn-outline-success" onclick="viewTopPerformers()">
                        View All
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm table-hover">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Turnover</th>
                                    <th>Revenue</th>
                                    <th>Trend</th>
                                </tr>
                            </thead>
                            <tbody id="topPerformersTable">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        let inventoryData = {
            abcAnalysis: [],
            turnoverData: [],
            recommendations: [],
            criticalItems: [],
            topPerformers: []
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadInventoryData();
            initializeInventoryCharts();
        });

        // Store inventory data globally for cross-function access
        window.inventoryData = {
            kpis: {},
            abcAnalysis: [],
            turnoverData: {},
            recommendations: [],
            criticalItems: [],
            agingData: []
        };

        async function loadInventoryData() {
            try {
                // Try to load real data from API, fallback to mock data
                const response = await fetch('/Report/InventoryOptimizationData');
                if (response.ok) {
                    const data = await response.json();
                    window.inventoryData = { ...window.inventoryData, ...data };
                    
                    // Update KPIs with real data
                    updateInventoryOverview();
                    
                    // Update charts and tables
                    await Promise.all([
                        loadABCData(),
                        loadTurnoverData(), 
                        loadRecommendations(),
                        loadCriticalItems(),
                        loadTopPerformers()
                    ]);
                } else {
                    throw new Error('Failed to fetch inventory data');
                }
            } catch (error) {
                console.error('Failed to load inventory optimization data:', error);
                showInventoryError('Unable to load inventory data. Please check your connection and try again.');
            }
        }

        async function loadABCData() {
            // Check if real data is available
            if (!window.inventoryData?.abcAnalysis?.length) {
                console.error('ABC Analysis data not available');
                return;
            }
            
            // Transform API data to match expected format
            inventoryData.abcAnalysis = window.inventoryData.abcAnalysis.map(item => ({
                class: item.Class || item.class,
                items: item.ItemCount || item.items,
                revenue: Math.round(item.RevenuePercentage || item.revenue),
                value: item.TotalValue || item.value
            }));
        }

        async function loadTurnoverData() {
            // Check if real data is available
            if (!window.inventoryData?.turnoverDistribution) {
                console.error('Turnover distribution data not available');
                return;
            }
            
            inventoryData.turnoverData = {
                fast: window.inventoryData.turnoverDistribution.Fast,
                medium: window.inventoryData.turnoverDistribution.Medium,
                slow: window.inventoryData.turnoverDistribution.Slow,
                dead: window.inventoryData.turnoverDistribution.Dead
            };
        }

        async function loadRecommendations() {
            // Check if real data is available
            if (!window.inventoryData?.recommendations?.length) {
                console.error('Recommendations data not available');
                showRecommendationsError();
                return;
            }
            
            inventoryData.recommendations = window.inventoryData.recommendations.map(rec => ({
                type: rec.Type?.toLowerCase() || rec.type,
                priority: rec.Priority?.toLowerCase() || rec.priority,
                title: rec.Title || rec.title,
                description: rec.Description || rec.description,
                impact: rec.Impact || rec.impact,
                effort: rec.Effort || rec.effort,
                timeline: rec.Timeline || rec.timeline
            }));

            renderRecommendations();
        }

        function renderRecommendations() {
            const container = document.getElementById('recommendationsList');
            let html = '';

            inventoryData.recommendations.forEach((rec, index) => {
                const priorityClass = rec.priority === 'high' ? 'danger' : rec.priority === 'medium' ? 'warning' : 'info';
                const iconClass = rec.type === 'reorder' ? 'arrow-circle-down' : rec.type === 'optimize' ? 'cog' : 'lightbulb';

                html += `
                    <div class="recommendation-item mb-3">
                        <div class="d-flex align-items-start">
                            <div class="recommendation-icon text-${priorityClass}">
                                <i class="fas fa-${iconClass}"></i>
                            </div>
                            <div class="recommendation-content flex-grow-1">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="mb-0">${rec.title}</h6>
                                    <span class="badge bg-${priorityClass}">${rec.priority.toUpperCase()}</span>
                                </div>
                                <p class="text-muted mb-2">${rec.description}</p>
                                <div class="recommendation-meta">
                                    <div class="row">
                                        <div class="col-sm-4">
                                            <small class="text-muted">Impact:</small><br>
                                            <strong class="text-success">${rec.impact}</strong>
                                        </div>
                                        <div class="col-sm-4">
                                            <small class="text-muted">Effort:</small><br>
                                            <span class="badge bg-secondary">${rec.effort}</span>
                                        </div>
                                        <div class="col-sm-4">
                                            <small class="text-muted">Timeline:</small><br>
                                            <span>${rec.timeline}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="recommendation-actions mt-3">
                                    <button class="btn btn-sm btn-outline-primary me-2" onclick="implementRecommendation(${index})">
                                        <i class="fas fa-play me-1"></i>Implement
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="analyzeRecommendation(${index})">
                                        <i class="fas fa-chart-line me-1"></i>Analyze
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadCriticalItems() {
            // Simulate critical items data
            inventoryData.criticalItems = [
                {
                    product: 'Amoxicillin 500mg',
                    issue: 'Below Reorder Point',
                    currentStock: 45,
                    reorderLevel: 150,
                    priority: 'critical'
                },
                {
                    product: 'Paracetamol 500mg',
                    issue: 'Excess Stock',
                    currentStock: 2400,
                    optimalStock: 800,
                    priority: 'warning'
                }
            ];

            renderCriticalItems();
        }

        function renderCriticalItems() {
            const tbody = document.getElementById('criticalItemsTable');
            let html = '';

            inventoryData.criticalItems.forEach(item => {
                const issueClass = item.priority === 'critical' ? 'danger' : 'warning';

                html += `
                    <tr>
                        <td><strong>${item.product}</strong></td>
                        <td><span class="badge bg-${issueClass}">${item.issue}</span></td>
                        <td>${item.currentStock}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="handleCriticalItem('${item.product}')">
                                <i class="fas fa-cog"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        async function loadTopPerformers() {
            // Simulate top performers data
            inventoryData.topPerformers = [
                {
                    product: 'Ibuprofen 400mg',
                    turnover: 8.2,
                    revenue: 45280,
                    trend: 'up'
                },
                {
                    product: 'Aspirin 325mg',
                    turnover: 7.8,
                    revenue: 38950,
                    trend: 'up'
                }
            ];

            renderTopPerformers();
        }

        function renderTopPerformers() {
            const tbody = document.getElementById('topPerformersTable');
            let html = '';

            inventoryData.topPerformers.forEach(item => {
                const trendIcon = item.trend === 'up' ? 'arrow-up text-success' : 'arrow-down text-danger';

                html += `
                    <tr>
                        <td><strong>${item.product}</strong></td>
                        <td><span class="badge bg-success">${item.turnover}x</span></td>
                        <td>${reportManager.formatCurrency(item.revenue)}</td>
                        <td><i class="fas fa-${trendIcon}"></i></td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        function initializeInventoryCharts() {
            // ABC Analysis Chart
            const abcCtx = document.getElementById('abcChart').getContext('2d');
            new Chart(abcCtx, {
                type: 'bar',
                data: {
                    labels: ['Class A (High Value)', 'Class B (Medium Value)', 'Class C (Low Value)'],
                    datasets: [
                        {
                            label: 'Number of Items',
                            data: inventoryData.abcAnalysis.map(item => item.items),
                            backgroundColor: ['rgba(220, 53, 69, 0.8)', 'rgba(255, 193, 7, 0.8)', 'rgba(40, 167, 69, 0.8)'],
                            borderColor: ['#dc3545', '#ffc107', '#28a745'],
                            borderWidth: 2,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Revenue %',
                            data: inventoryData.abcAnalysis.map(item => item.revenue),
                            type: 'line',
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Number of Items'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Revenue Percentage (%)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return 'Items: ' + context.parsed.y;
                                    } else {
                                        return 'Revenue: ' + context.parsed.y + '%';
                                    }
                                }
                            }
                        }
                    }
                }
            });

            // Turnover Distribution Chart
            const turnoverCtx = document.getElementById('turnoverChart').getContext('2d');
            new Chart(turnoverCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Fast Moving (>6x)', 'Medium (2-6x)', 'Slow Moving (<2x)', 'Dead Stock (0x)'],
                    datasets: [{
                        data: [
                            inventoryData.turnoverData.fast,
                            inventoryData.turnoverData.medium,
                            inventoryData.turnoverData.slow,
                            inventoryData.turnoverData.dead
                        ],
                        backgroundColor: ['#28a745', '#17a2b8', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ' + context.parsed + ' items (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateInventoryOverview() {
            // Update KPI cards with real data if available, otherwise calculate from mock data
            if (window.inventoryData?.kpis) {
                const kpis = window.inventoryData.kpis;
                
                // Update main KPIs
                document.getElementById('totalItems').textContent = kpis.totalItems?.toLocaleString() || '2,847';
                document.getElementById('avgTurnover').textContent = kpis.avgTurnover ? `${kpis.avgTurnover}x` : '4.2x';
                document.getElementById('reorderPoints').textContent = kpis.reorderAlerts?.toLocaleString() || '23';
                document.getElementById('slowMoving').textContent = kpis.slowMovingItems?.toLocaleString() || '147';
                document.getElementById('excessStock').textContent = kpis.excessStockValue ? `$${kpis.excessStockValue.toLocaleString()}` : '$45,280';
                document.getElementById('efficiency').textContent = kpis.efficiency ? `${kpis.efficiency}%` : '87%';
                
                // Update inventory value in the total items card
                const totalValueElement = document.querySelector('#totalItems').nextElementSibling?.nextElementSibling;
                if (totalValueElement && kpis.totalValue) {
                    totalValueElement.textContent = `$${kpis.totalValue.toLocaleString()} value`;
                }
            } else {
                // Fallback: Update with calculated values from mock data
                const totalItems = Object.values(inventoryData.turnoverData).reduce((sum, count) => sum + count, 0);
                document.getElementById('totalItems').textContent = totalItems.toLocaleString();
                
                // Update other KPIs with mock values if elements exist
                const avgTurnoverEl = document.getElementById('avgTurnover');
                const reorderPointsEl = document.getElementById('reorderPoints');
                const slowMovingEl = document.getElementById('slowMoving');
                const excessStockEl = document.getElementById('excessStock');
                const efficiencyEl = document.getElementById('efficiency');
                
                if (avgTurnoverEl) avgTurnoverEl.textContent = '4.2x';
                if (reorderPointsEl) reorderPointsEl.textContent = '23';
                if (slowMovingEl) slowMovingEl.textContent = '147';
                if (excessStockEl) excessStockEl.textContent = '$45,280';
                if (efficiencyEl) efficiencyEl.textContent = '87%';
            }
            
            // Update critical items count if available
            const criticalItemsEl = document.getElementById('criticalItemsCount');
            if (criticalItemsEl) {
                criticalItemsEl.textContent = inventoryData.criticalItems?.length || 0;
            }
        }

        // Action functions
        function refreshABCAnalysis() {
            loadABCData();
            reportManager.showToast('ABC analysis refreshed', 'success');
        }

        function updateTurnoverAnalysis() {
            const period = document.getElementById('turnoverPeriod').value;
            reportManager.showToast(`Turnover analysis updated for ${period} period`, 'info');
        }

        function implementRecommendations() {
            reportManager.showToast('Auto-implementation started for top recommendations', 'success');
        }

        function implementRecommendation(index) {
            const rec = inventoryData.recommendations[index];
            reportManager.showToast(`Implementing: ${rec.title}`, 'info');
        }

        function analyzeRecommendation(index) {
            const rec = inventoryData.recommendations[index];
            reportManager.showToast(`Analyzing impact of: ${rec.title}`, 'info');
        }

        function handleCriticalItem(product) {
            reportManager.showToast(`Managing critical item: ${product}`, 'warning');
        }

        function viewTopPerformers() {
            reportManager.showToast('Opening detailed top performers analysis', 'info');
        }

        function generateReorderAlert() {
            reportManager.showToast('Reorder alert system activated', 'warning');
        }

        function exportInventoryReport() {
            reportManager.showToast('Generating comprehensive inventory optimization report...', 'info');
        }

        // Error handling functions
        function showInventoryError(message) {
            // Show error in KPI cards
            ['totalItems', 'avgTurnover', 'reorderPoints', 'slowMoving', 'excessStock', 'efficiency'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.innerHTML = '<i class="fas fa-exclamation-triangle text-danger"></i> Error';
                }
            });
            
            // Show error in charts
            const chartIds = ['abcAnalysisChart', 'turnoverChart', 'inventoryTrendChart'];
            chartIds.forEach(chartId => {
                const canvas = document.getElementById(chartId);
                if (canvas) {
                    const parent = canvas.parentElement;
                    parent.innerHTML = `
                        <div class="text-center py-5">
                            <i class="fas fa-exclamation-triangle text-danger fa-3x mb-3"></i>
                            <h5 class="text-muted">Unable to load inventory data</h5>
                            <button class="btn btn-outline-primary btn-sm mt-2" onclick="window.location.reload()">
                                <i class="fas fa-refresh me-1"></i>Retry
                            </button>
                        </div>
                    `;
                }
            });
            
            // Show error toast
            reportManager.showToast(message, 'danger');
        }

        function showRecommendationsError() {
            const container = document.getElementById('recommendationsList');
            if (container) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-exclamation-triangle text-danger fa-2x mb-3"></i>
                        <h5 class="text-muted">Unable to load recommendations</h5>
                        <p class="text-muted">Optimization recommendations are not available</p>
                        <button class="btn btn-outline-primary btn-sm mt-2" onclick="window.location.reload()">
                            <i class="fas fa-refresh me-1"></i>Retry
                        </button>
                    </div>
                `;
            }
        }
    </script>
}

<style>
.inventory-header {
    background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
    color: white;
    border-radius: 15px;
    padding: 2rem;
}

.inventory-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.inventory-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 0;
}

.inventory-card {
    background: white;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    transition: all 0.3s ease;
    border-left: 4px solid;
    height: 100%;
}

.inventory-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
}

.inventory-card.total {
    border-left-color: #6f42c1;
}

.inventory-card.turnover {
    border-left-color: #17a2b8;
}

.inventory-card.reorder {
    border-left-color: #ffc107;
}

.inventory-card.slow {
    border-left-color: #fd7e14;
}

.inventory-card.excess {
    border-left-color: #dc3545;
}

.inventory-card.efficiency {
    border-left-color: #28a745;
}

.inventory-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    margin-bottom: 1rem;
}

.inventory-card.total .inventory-icon {
    background: #6f42c1;
}

.inventory-card.turnover .inventory-icon {
    background: #17a2b8;
}

.inventory-card.reorder .inventory-icon {
    background: #ffc107;
    color: #212529;
}

.inventory-card.slow .inventory-icon {
    background: #fd7e14;
}

.inventory-card.excess .inventory-icon {
    background: #dc3545;
}

.inventory-card.efficiency .inventory-icon {
    background: #28a745;
}

.inventory-content h3 {
    font-size: 1.8rem;
    font-weight: 700;
    margin: 0;
    color: #2c3e50;
}

.inventory-label {
    color: #6c757d;
    font-size: 0.85rem;
    margin: 0;
    font-weight: 500;
}

.inventory-metric {
    font-size: 0.75rem;
    font-weight: 600;
    color: #495057;
    margin-top: 0.25rem;
}

.abc-summary {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1rem;
}

.abc-item {
    padding: 1rem;
    border-radius: 8px;
}

.abc-item.a-class {
    background: rgba(220, 53, 69, 0.1);
}

.abc-item.b-class {
    background: rgba(255, 193, 7, 0.1);
}

.abc-item.c-class {
    background: rgba(40, 167, 69, 0.1);
}

.abc-item h4 {
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: #2c3e50;
}

.turnover-metrics {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1rem;
}

.metric-item {
    margin-bottom: 1rem;
}

.metric-item:last-child {
    margin-bottom: 0;
}

.metric-label {
    font-size: 0.875rem;
    color: #6c757d;
    font-weight: 500;
}

.recommendation-item {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 1.5rem;
    background: white;
}

.recommendation-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    margin-right: 1rem;
    flex-shrink: 0;
}

.recommendation-content {
    min-width: 0;
}

.recommendation-meta {
    background: #f8f9fa;
    border-radius: 6px;
    padding: 1rem;
    margin-top: 1rem;
}

.savings-item {
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    margin-bottom: 1rem;
}

@@media (max-width: 768px) {
    .inventory-header {
        text-align: center;
        padding: 1.5rem;
    }
    
    .inventory-title {
        font-size: 1.8rem;
    }
    
    .inventory-card {
        margin-bottom: 1rem;
    }
    
    .recommendation-item {
        padding: 1rem;
    }
    
    .recommendation-icon {
        width: 30px;
        height: 30px;
        font-size: 14px;
    }
    
    .recommendation-meta .row {
        flex-direction: column;
    }
    
    .recommendation-actions {
        text-align: center;
    }
}
</style>